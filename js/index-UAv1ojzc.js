const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/views/About-B0QLw5jp.js","js/vendor/vendor-C7G-2uNe.js","css/vendor-J62Qy6MM.css","css/About-BlBRjbGu.css"])))=>i.map(i=>d[i]);
import{c as e,r as t,o as a,a as l,w as s,b as n,d as r,e as d,f as i,g as o,h as u,i as c,v,j as m,n as g,k as p,F as h,l as x,m as b,t as y,p as f,E as w,q as E,s as k,H as _,u as R,x as M,y as L,z as U,A as O,B as T,C as $}from"./vendor/vendor-C7G-2uNe.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const C=(e,t)=>{const a=e.__vccOpts||e;for(const[l,s]of t)a[l]=s;return a};const S=C({},[["render",function(l,s){const n=t("router-view");return a(),e(n)}]]),A={UPLOAD_SUCCESS:"上传成功",UPLOAD_FAILED:"上传失败",UPLOAD_CANCELLED:"上传取消",UPLOAD_ERROR:"上传错误",UPLOAD_TIMEOUT:"上传超时",UPLOAD_REJECTED:"上传被拒绝",UPLOAD_ABORTED:"上传被中止",UPLOAD_RETRY:"上传重试",UPLOAD_RETRY_FAILED:"上传重试失败"},D={CRUD_STATUS:{ADD:"add",EDIT:"edit",DELETE:"delete"},HTTP_CODE:{SUCCESS:{code:200,message:"请求成功"},ERROR:{code:500,message:"请求失败"},UNAUTHORIZED:{code:401,message:"未授权"},FORBIDDEN:{code:403,message:"禁止访问"},NOT_FOUND:{code:404,message:"未找到"},METHOD_NOT_ALLOWED:{code:405,message:"方法不允许"},CONFLICT:{code:409,message:"冲突"},INTERNAL_SERVER_ERROR:{code:500,message:"内部服务器错误"}},HTTP_ERROR_MSG:{DEFAULT:"后台服务异常，请稍后再试",UNAUTHORIZED:"未授权，请重新登录",FORBIDDEN:"禁止访问，请联系管理员",NOT_FOUND:"未找到，请检查路径是否正确",METHOD_NOT_ALLOWED:"方法不允许，请检查请求方法是否正确",CONFLICT:"冲突，请检查请求参数是否正确",INTERNAL_SERVER_ERROR:"内部服务器错误，请稍后再试"}},P={install:e=>{e.config.globalProperties.$constant={global:D,file:A}}},H={},F={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8"},I={class:"max-w-4xl mx-auto px-4"},N={class:"bg-white rounded-lg shadow-lg p-4 md:p-6 mb-6"},j={class:"mb-4"},z={class:"flex flex-col sm:flex-row gap-2"},W={class:"flex gap-2"},q=["disabled","title"],G={key:0,class:"text-xs text-gray-500 mt-1 flex items-center gap-1"},B={class:"mb-4 flex flex-wrap items-center gap-4"},V={class:"flex items-center gap-2 text-sm"},K={key:0,class:"text-xs text-gray-500"},J={key:0,class:"mb-4 p-4 bg-gray-50 border border-gray-200 rounded-lg"},Y={class:"space-y-2 max-h-48 overflow-y-auto"},Z={class:"w-32 font-mono text-xs text-gray-600"},Q=["onUpdate:modelValue","placeholder"],X=["onClick"],ee={class:"mb-4"},te={class:"flex gap-2 flex-wrap"},ae=["onClick","title"],le={key:1,class:"mb-4 border-t pt-4"},se={class:"flex items-center justify-between mb-3"},ne={class:"max-h-48 overflow-y-auto space-y-2"},re={class:"flex-1 min-w-0"},de={class:"text-sm font-medium text-gray-900 truncate"},ie={class:"text-xs text-gray-500"},oe={class:"flex gap-1 ml-2"},ue=["onClick"],ce=["onClick"],ve={key:0,class:"text-center text-gray-500 text-sm py-4"},me={class:"space-y-3"},ge={class:"flex gap-2 md:gap-3 flex-wrap"},pe=["disabled"],he={key:0,class:"animate-spin"},xe={key:1,class:"mr-1"},be={class:"flex gap-2 md:gap-3 flex-wrap"},ye=["disabled"],fe={key:0,class:"animate-spin mr-1"},we={class:"hidden sm:inline"},Ee={class:"sm:hidden"},ke=["disabled"],_e={key:2,class:"flex-1 px-3 md:px-6 py-2 bg-gray-400 text-white rounded-lg text-sm md:text-base text-center cursor-not-allowed"},Re={key:2,class:"mt-4"},Me={key:0,class:"ml-2 text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded"},Le={key:3,class:"mt-4"},Ue={class:"text-sm text-purple-600 mb-2"},Oe={key:0,class:"mb-3"},Te={class:"flex justify-between text-xs text-gray-500 mb-1"},$e={class:"w-full bg-gray-200 rounded-full h-2"},Ce={key:4,class:"mt-4"},Se={class:"text-sm text-orange-600 mb-2"},Ae={key:0,class:"mb-3"},De={class:"flex justify-between text-xs text-gray-500 mb-1"},Pe={class:"w-full bg-gray-200 rounded-full h-2"},He={key:1,class:"mb-4"},Fe={class:"grid grid-cols-3 gap-2"},Ie=["title"],Ne={key:2,class:"mb-4"},je={class:"text-xs text-gray-600 mb-2"},ze=["title"],We=["title"],qe={key:3,class:"text-xs text-gray-500 mt-2"},Ge={key:5,class:"mt-4"},Be={class:"space-y-2"},Ve={class:"flex justify-between text-xs text-gray-500"},Ke=["title"],Je={key:0,class:"text-xs text-gray-400 text-center"},Ye={class:"bg-white rounded-lg shadow-lg p-4 md:p-6"},Ze={class:"mb-4 flex items-center justify-between"},Qe={class:"flex gap-1 md:gap-2"},Xe={class:"relative"},et={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg"},tt={key:1,class:"absolute inset-0 bg-gray-100 flex items-center justify-center rounded-lg"},at={class:"mt-4 text-xs md:text-sm text-gray-600"},lt={class:"flex items-center gap-2"},st={key:0,class:"text-blue-600"},nt={class:"mt-8 bg-white rounded-lg shadow-lg p-4 md:p-6"},rt={class:"mt-6 p-4 bg-green-50 border border-green-200 rounded-lg"},dt={class:"text-sm text-green-700 space-y-2"},it={class:"bg-green-100 p-3 rounded border-l-4 border-green-400"},ot={class:"space-y-1"},ut={key:0},ct={key:1},vt={class:"text-xs text-green-600 mt-2 space-y-2"},mt={class:"flex items-center justify-between p-2 bg-white rounded border"},gt={class:"flex items-center gap-2"},pt={class:"text-xs text-gray-500"},ht={class:"flex items-center justify-between"},xt={class:"font-medium text-green-800"},bt={class:"flex gap-2"},yt={key:0,class:"mt-2 p-2 bg-white rounded border"},ft={class:"space-y-1"},wt={class:"flex items-center gap-2"},Et=["id","value","onChange"],kt=["for"],_t={key:0,class:"text-xs text-green-600 font-medium"},Rt={key:0,class:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg"},Mt=C({__name:"HomeView",setup(e){const t=l(""),U=l(null),O=l(!1),T=l(!0),$=l([]),C=l(!1),S=l(!1),A=l(null),D=l("未使用"),P=l(!1),H=l(!1);s(H,(e=>{e?w.info("已切换到代理模式，下次播放将优先使用代理"):w.info("已切换到直接模式，下次播放将优先直接访问")}));const Mt=l(""),Lt=l(0),Ut=l(""),Ot=l(!1),Tt=l([]),$t=l(0),Ct=l(0),St=l(0),At=l(""),Dt=l(!1),Pt=l([]),Ht=l([{id:"init",name:"初始化",status:"pending"},{id:"parse",name:"解析M3U8",status:"pending"},{id:"download",name:"下载片段",status:"pending"},{id:"merge",name:"合并片段",status:"pending"},{id:"convert",name:"转换格式",status:"pending"},{id:"generate",name:"生成文件",status:"pending"}]),Ft=l(null),It=l(null),Nt=l(!1),jt=l(!0),zt=["https://cors-anywhere.herokuapp.com/","https://proxy.corsfix.com/?","https://api.codetabs.com/v1/proxy?quest=","https://corsproxy.io/?"],Wt=l(0),qt=l({"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Referer:"",Origin:"",Accept:"*/*","Accept-Language":"zh-CN,zh;q=0.9,en;q=0.8","Cache-Control":"no-cache","Sec-Fetch-Dest":"empty","Sec-Fetch-Mode":"cors","Sec-Fetch-Site":"cross-site"}),Gt=l(!1),Bt=[{name:"测试视频",url:"https://test-streams.mux.dev/x36xhzz/url_6/193039199_mp4_h264_aac_hq_7.m3u8"},{name:"Sintel 演示视频",url:"https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8"}],Vt=async e=>{try{await k();const t=U.value;if(!t)throw new Error("Video element not found");if(t._isInitializing)return;if(t._isInitializing=!0,t.controls=!0,t.autoplay=T.value,t.muted=T.value,t.volume=.8,t.playsInline=!0,t.crossOrigin="anonymous",_.isSupported()){t._hls&&(t._hls.destroy(),t._hls=null);const a=new _({xhrSetup:function(e,t){const a=new URL(t);Object.entries(qt.value).forEach((([t,l])=>{if(l){let n=l;"Referer"!==t||l||(n=a.origin+"/"),"Origin"!==t||l||(n=a.origin);try{e.setRequestHeader(t,n)}catch(s){}}}))},enableWorker:!0,lowLatencyMode:!1,backBufferLength:90});a.attachMedia(t),a.loadSource(e),t._hls=a,Jt(a)}else{if(!t.canPlayType("application/vnd.apple.mpegurl"))throw new Error("HLS is not supported in this browser");t.src=e}Kt(),t._isInitializing=!1}catch(t){w.error("播放器初始化失败"),U.value&&(U.value._isInitializing=!1)}},Kt=()=>{const e=U.value;if(!e)return;["loadstart","canplay","play","pause","ended","error","timeupdate"].forEach((t=>{e[`_${t}Handler`]&&(e.removeEventListener(t,e[`_${t}Handler`]),delete e[`_${t}Handler`])})),e._loadstartHandler=()=>{Mt.value="开始加载视频",O.value=!0},e.addEventListener("loadstart",e._loadstartHandler),e._canplayHandler=()=>{O.value=!1,Mt.value="视频已准备就绪"},e.addEventListener("canplay",e._canplayHandler),e._playHandler=()=>{Mt.value="正在播放"},e.addEventListener("play",e._playHandler),e._pauseHandler=()=>{Mt.value="播放已暂停"},e.addEventListener("pause",e._pauseHandler),e._endedHandler=()=>{Mt.value="播放完成"},e.addEventListener("ended",e._endedHandler),e._errorHandler=e=>{O.value=!1,Mt.value="视频加载失败",w.error("视频播放失败，请检查链接是否有效")},e.addEventListener("error",e._errorHandler),e._timeupdateHandler=()=>{if(e&&e.currentTime&&e.duration){const t=Math.floor(e.currentTime),a=Math.floor(e.duration);a>0&&(Mt.value=`播放中 ${Yt(t)} / ${Yt(a)}`)}},e.addEventListener("timeupdate",e._timeupdateHandler)},Jt=e=>{e._eventHandlers&&e._eventHandlers.forEach((({event:t,handler:a})=>{e.off(t,a)})),e._eventHandlers=[];const t=()=>{Mt.value="HLS 清单解析完成"};e.on(_.Events.MANIFEST_PARSED,t),e._eventHandlers.push({event:_.Events.MANIFEST_PARSED,handler:t});const a=()=>{};e.on(_.Events.LEVEL_LOADED,a),e._eventHandlers.push({event:_.Events.LEVEL_LOADED,handler:a});const l=(t,a)=>{if(a.fatal)switch(a.type){case _.ErrorTypes.NETWORK_ERROR:e.startLoad();break;case _.ErrorTypes.MEDIA_ERROR:e.recoverMediaError();break;default:e.destroy(),Mt.value="HLS 播放失败",w.error("HLS 播放出现致命错误")}};e.on(_.Events.ERROR,l),e._eventHandlers.push({event:_.Events.ERROR,handler:l});const s=()=>{"开始加载视频"!==Mt.value&&"HLS 清单解析完成"!==Mt.value||(Mt.value="正在加载视频片段")};e.on(_.Events.FRAG_LOADING,s),e._eventHandlers.push({event:_.Events.FRAG_LOADING,handler:s});const n=()=>{"正在加载视频片段"===Mt.value&&(Mt.value="视频片段加载完成")};e.on(_.Events.FRAG_LOADED,n),e._eventHandlers.push({event:_.Events.FRAG_LOADED,handler:n})},Yt=e=>{const t=Math.floor(e/3600),a=Math.floor(e%3600/60),l=e%60;return t>0?`${t}:${a.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`:`${a}:${l.toString().padStart(2,"0")}`},Zt=async()=>{t.value.trim()?(A.value&&(clearTimeout(A.value),A.value=null),A.value=setTimeout((async()=>{O.value=!0,Mt.value="正在初始化播放器...";try{if(H.value){Mt.value="正在使用代理播放...";let a=!1;for(let l=0;l<zt.length;l++){const s=(Wt.value+l)%zt.length,n=zt[s];try{const e=n+encodeURIComponent(t.value);await Vt(e),Wt.value=s,D.value=`代理 ${s+1} (正在使用)`,Mt.value=`通过代理 ${s+1} 播放成功`,w.success(`已通过代理 ${s+1} 成功播放视频`),Qt(t.value),a=!0;break}catch(e){continue}}if(!a)throw new Error("所有代理都失败了")}else await Vt(t.value),D.value="直接播放 (无需代理)",Qt(t.value)}catch(a){if(H.value){Mt.value="代理失败，尝试直接播放...";try{await Vt(t.value),D.value="直接播放 (代理失败回退)",Qt(t.value)}catch(l){throw l}}else{Mt.value="直接访问失败，尝试代理播放...";let a=!1;for(let l=0;l<zt.length;l++){const s=(Wt.value+l)%zt.length,n=zt[s];try{const e=n+encodeURIComponent(t.value);await Vt(e),Wt.value=s,D.value=`代理 ${s+1} (正在使用)`,Mt.value=`通过代理 ${s+1} 播放成功`,w.success(`已通过代理 ${s+1} 成功播放视频`),Qt(t.value),a=!0;break}catch(e){continue}}a||(O.value=!1,Mt.value="所有播放方式都失败了",w.error("播放失败: 该资源可能需要特殊的访问权限"))}}}),300)):w.warning("请输入有效的 M3U8 链接")},Qt=e=>{const t={url:e,title:Xt(e),timestamp:(new Date).toLocaleString(),id:Date.now()},a=$.value.findIndex((t=>t.url===e));a>-1&&$.value.splice(a,1),$.value.unshift(t),$.value.length>20&&($.value=$.value.slice(0,20)),ea()},Xt=e=>{try{const t=new URL(e),a=t.pathname;return a.split("/").pop()||t.hostname||"M3U8 视频"}catch{return"M3U8 视频"}},ea=()=>{try{localStorage.setItem("m3u8-history",JSON.stringify($.value))}catch(e){}},ta=()=>{$.value=[],ea(),C.value=!1,w.success("历史记录已清空")},aa=async()=>{t.value.trim()?(w.info("🎬 开始播放视频..."),await Zt()):w.warning("请先输入 M3U8 链接")},la=()=>{if(Mt.value&&Mt.value.includes("失败")&&(Mt.value=""),t.value.trim())try{const e=new URL(t.value.trim());qt.value.Referer||(qt.value.Referer=e.origin+"/"),qt.value.Origin||(qt.value.Origin=e.origin)}catch(e){}},sa=()=>{const e=prompt("请输入 Header 名称:"),t=prompt("请输入 Header 值:");e&&t&&(qt.value[e]=t,w.success(`已添加 Header: ${e}`))},na=()=>{qt.value={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Referer:"",Origin:"",Accept:"*/*","Accept-Language":"zh-CN,zh;q=0.9,en;q=0.8","Cache-Control":"no-cache","Sec-Fetch-Dest":"empty","Sec-Fetch-Mode":"cors","Sec-Fetch-Site":"cross-site"},w.success("Header 已重置为默认值")},ra=async()=>{if(t.value.trim())try{const e=zt[Wt.value]+encodeURIComponent(t.value);await Vt(e),D.value=`代理 ${Wt.value+1} (测试成功)`,w.success("代理测试成功")}catch(e){D.value=`代理 ${Wt.value+1} (测试失败)`,w.error("代理测试失败: "+e.message)}else w.warning("请先输入 M3U8 链接")},da=(e,t)=>{const a=Ht.value.find((t=>t.id===e));a&&(a.status=t)},ia=()=>{Ht.value.forEach((e=>{e.status="pending"})),Pt.value=[]},oa=()=>{Ft.value&&(Ft.value.abort(),Ft.value=null),Dt.value=!1,At.value="转换已取消",St.value=0,ia(),w.info("MP4 转换已取消")},ua=async(e,t={},a=2)=>{for(let s=1;s<=a;s++)try{const a=await fetch(e,t);if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);return a}catch(l){if(s===a)throw l;await new Promise((e=>setTimeout(e,1e3*s)))}},ca=async(e,t={})=>{try{const a=new URL(e),l={};Object.entries(qt.value).forEach((([e,t])=>{if(t){let s=t;"Referer"!==e||t||(s=a.origin+"/"),"Origin"!==e||t||(s=a.origin),l[e]=s}}));const s=await fetch(e,{...t,headers:{...l,...t.headers},mode:"cors"});if(s.ok)return s;throw new Error(`Direct request failed: ${s.status}`)}catch(a){for(let s=0;s<zt.length;s++){const a=(Wt.value+s)%zt.length,n=zt[a]+encodeURIComponent(e);try{const e=await fetch(n,{...t,headers:{Accept:"*/*","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",...t.headers}});if(e.ok)return Wt.value=a,e}catch(l){continue}}throw new Error("所有代理都无法访问该资源，可能需要特殊的访问权限")}},va=async()=>{if(t.value.trim())try{Ut.value="正在获取 M3U8 文件...";const e=await ca(t.value,{method:"GET",headers:{"Accept-Language":"zh-CN,zh;q=0.9,en;q=0.8","Cache-Control":"no-cache"}}),a=await e.text(),l=new Blob([a],{type:"application/x-mpegURL"}),s=URL.createObjectURL(l),n=document.createElement("a");n.href=s,n.download=`video_${Date.now()}.m3u8`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s),Ut.value="M3U8 文件下载完成",w.success("M3U8 文件下载成功")}catch(e){Ut.value="M3U8 文件下载失败",e.message.includes("403")?(w.error("下载失败: 该资源有防盗链保护，无法直接下载"),w.info("💡 建议：尝试使用浏览器插件或其他工具下载")):e.message.includes("CORS")?w.error("下载失败: 跨域限制，该资源不允许跨站访问"):w.error("下载失败: "+e.message)}else w.warning("请先输入 M3U8 链接")},ma=async()=>{if(t.value.trim())if(Ot.value||Dt.value)w.warning("正在处理中，请稍候...");else try{Ot.value=!0,Ut.value="正在解析 M3U8 文件...",Lt.value=0,Tt.value=[];const e=await ca(t.value,{method:"GET",headers:{"Accept-Language":"zh-CN,zh;q=0.9,en;q=0.8"}}),a=await e.text(),l=pa(a,t.value);if(0===l.length)throw new Error("未找到视频片段");$t.value=l.length,Ct.value=0,Tt.value=l.map(((e,t)=>({id:t,url:e,status:"pending",progress:0,size:0}))),Ut.value=`发现 ${l.length} 个视频片段，开始下载...`;const s=3,n=new Array(l.length);let r=0;const d=async e=>{const t=Tt.value[e];t.status="downloading";try{const a=await ca(t.url,{method:"GET"}),s=await a.blob();n[e]=s,t.status="completed",t.size=s.size,r++,Ct.value=r,Lt.value=Math.round(r/l.length*90),Ut.value=`下载进度: ${r}/${l.length} (${Math.round(r/l.length*100)}%)`}catch(a){t.status="error",r++,Ct.value=r}};for(let t=0;t<l.length;t+=s){const e=[];for(let a=t;a<Math.min(t+s,l.length);a++)e.push(d(a));await Promise.all(e)}const i=n.filter((e=>null!=e));if(0===i.length)throw new Error("没有成功下载的视频片段");Ut.value="正在合并视频文件...",Lt.value=95;const o=new Blob(i,{type:"video/mp2t"}),u=URL.createObjectURL(o),c=document.createElement("a");c.href=u,c.download=`video_${Date.now()}.ts`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(u),Lt.value=100,Ut.value=`视频文件下载完成 (${i.length}/${l.length} 个片段)`,w.success(`视频文件下载成功！成功下载 ${i.length}/${l.length} 个片段`)}catch(e){Ut.value="MP4 下载失败",w.error("下载失败: "+e.message)}finally{Ot.value=!1,setTimeout((()=>{Ot.value||(Lt.value=0,Tt.value=[],$t.value=0,Ct.value=0)}),5e3)}else w.warning("请先输入 M3U8 链接")},ga=async()=>{if(t.value.trim())if(Ot.value||Dt.value)w.warning("正在处理中，请稍候...");else try{Dt.value=!0,Ft.value=new AbortController,ia(),da("init","downloading"),At.value="正在初始化转换工具...",St.value=0;if(!(await ya()))throw new Error("视频转换工具初始化失败");let d;da("init","completed"),da("parse","downloading"),At.value="正在解析 M3U8 文件...",St.value=10;try{At.value="正在下载 M3U8 文件...",d=await ua(t.value,{method:"GET",headers:qt.value,signal:Ft.value.signal})}catch(e){At.value="直接访问失败，尝试代理...",d=await ca(t.value,{method:"GET",signal:Ft.value.signal})}const i=await d.text(),o=pa(i,t.value);if(0===o.length)throw new Error("未找到视频片段");da("parse","completed"),da("download","downloading"),At.value="正在下载视频片段...",St.value=20,Pt.value=o.map(((e,t)=>({id:t,url:e,status:"pending"})));const u=3,c=[];for(let t=0;t<o.length;t+=u){const a=[];for(let n=t;n<Math.min(t+u,o.length);n++)Pt.value[n]&&(Pt.value[n].status="downloading"),a.push((async()=>{try{const e=await ua(o[n],{method:"GET",headers:qt.value,signal:Ft.value.signal}),t=await e.blob();return Pt.value[n]&&(Pt.value[n].status="completed"),t}catch(e){try{const e=await ca(o[n],{method:"GET",signal:Ft.value.signal}),t=await e.blob();return Pt.value[n]&&(Pt.value[n].status="completed"),t}catch(t){return Pt.value[n]&&(Pt.value[n].status="error"),t.name,null}}})());const l=await Promise.all(a);c.push(...l.filter((e=>null!==e)));const s=20+Math.min(t+u,o.length)/o.length*30;St.value=Math.round(s),At.value=`下载进度: ${Math.min(t+u,o.length)}/${o.length} 个片段`}if(0===c.length)throw new Error("没有成功下载的视频片段");da("download","completed"),da("merge","downloading");const v=new Blob(c,{type:"video/mp2t"}),m=524288e3;if(v.size>m)throw new Error(`文件过大 (${Math.round(v.size/1024/1024)}MB)，请尝试下载 TS 文件或选择较小的视频`);da("merge","completed"),da("convert","downloading"),At.value="正在转换为 MP4 格式...",St.value=60;const g=Math.round(v.size/1024/1024);let p=12e4,h=!1;g>100?(p=3e5,h=!0):g>50?(p=24e4,h=!0):g>20&&(p=18e4);const x="input.ts",b="output.mp4";try{if(!It.value)throw new Error("FFmpeg 实例未初始化");try{await It.value.deleteFile(x)}catch(a){}try{await It.value.deleteFile(b)}catch(a){}let e;At.value="正在写入输入文件...",await It.value.writeFile(x,await E(v)),At.value="正在转换为 MP4 格式...",St.value=70,h?(At.value="正在快速转换为 MP4 格式...",e=["-i",x,"-c","copy","-movflags","+faststart",b]):(At.value="正在转换为 MP4 格式...",e=["-i",x,"-c:v","libx264","-c:a","aac","-preset","ultrafast","-crf","28","-movflags","+faststart","-threads","0","-tune","fastdecode",b]);const t=It.value.exec(e),s=new Promise(((e,t)=>{setTimeout((()=>t(new Error(`转换超时 (${p/1e3}秒)，请尝试重新转换或选择较小的视频`))),p)})),n=setInterval((()=>{St.value<85&&(St.value=Math.min(85,St.value+1),At.value=`正在转换为 MP4 格式... (${St.value}%)`)}),2e3);try{await Promise.race([t,s]),clearInterval(n)}catch(l){throw clearInterval(n),l}}catch(s){try{At.value="尝试简单转换方式...";const e=It.value.exec(["-i",x,"-c","copy",b]),t=Math.max(6e4,p/2),a=new Promise(((e,a)=>{setTimeout((()=>a(new Error(`简单转换超时 (${t/1e3}秒)`))),t)}));await Promise.race([e,a])}catch(n){throw new Error(`FFmpeg 转换失败: ${s.message}`)}}da("convert","completed"),da("generate","downloading"),St.value=90,At.value="正在生成下载文件...",St.value=95;const y=await It.value.readFile(b),f=new Blob([y],{type:"video/mp4"}),k=URL.createObjectURL(f),_=document.createElement("a");_.href=k,_.download=`video_${Date.now()}.mp4`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(k),da("generate","completed");try{It.value&&(await It.value.deleteFile(x),await It.value.deleteFile(b))}catch(r){}St.value=100,At.value="MP4 文件转换完成",w.success("MP4 文件转换并下载成功！")}catch(l){let e="转换失败: ";l.message.includes("Failed to fetch")?e+="网络连接失败，请检查网络连接或尝试使用代理":l.message.includes("CORS")?e+="跨域访问被阻止，请尝试使用代理":l.message.includes("FS error")?e+="文件系统错误，可能是文件过大或内存不足":l.message.includes("ErrnoError")?e+="文件操作错误，请尝试重新转换":l.message.includes("文件过大")?e+=l.message:l.message.includes("转换超时")?e+="转换超时，请尝试重新转换或选择较小的视频":l.message.includes("AbortError")?e+="转换已取消":e+=l.message,At.value="MP4 转换失败: "+l.message,w.error(e);try{It.value&&(await It.value.deleteFile("input.ts"),await It.value.deleteFile("output.mp4"))}catch(r){}}finally{if(Dt.value=!1,Ft.value&&(Ft.value=null),It.value)try{Nt.value=!1,It.value=null}catch(l){}setTimeout((()=>{Dt.value||(St.value=0,At.value="")}),3e3)}else w.warning("请先输入 M3U8 链接")},pa=(e,t)=>{const a=e.split("\n").filter((e=>e.trim())),l=[],s=new URL(t),n=t.substring(0,t.lastIndexOf("/")+1);for(const r of a)if(!r.startsWith("#")&&r.trim()){let e=r.trim();e.startsWith("http")||(e=e.startsWith("/")?`${s.protocol}//${s.host}${e}`:n+e),l.push(e)}return l},ha=()=>{t.value="",U.value&&(U.value._hls&&(U.value._hls.destroy(),U.value._hls=null),U.value.src="",U.value.load()),Mt.value="",Ut.value="",Lt.value=0,Tt.value=[],$t.value=0,Ct.value=0,At.value="",St.value=0},xa=()=>{if(U.value)try{U.value.requestFullscreen()}catch(e){w.warning("全屏功能不可用")}},ba=async()=>{if(t.value.trim()){Mt.value="正在刷新播放器...";try{await Vt(t.value),w.success("播放器刷新成功")}catch(e){w.error("刷新播放器失败")}}else w.warning("请先输入 M3U8 链接")},ya=async()=>{try{if(It.value)try{It.value=null}catch(e){}It.value=new R,At.value="正在加载转换工具...";try{const e="/m3u8palyer/ffmpeg";return await It.value.load({coreURL:await M(`${e}/ffmpeg-core.js`,"text/javascript"),wasmURL:await M(`${e}/ffmpeg-core.wasm`,"application/wasm")}),Nt.value=!0,At.value="转换工具加载完成",!0}catch(t){return It.value=new R,await It.value.load(),Nt.value=!0,At.value="转换工具加载完成",!0}}catch(a){return At.value="FFmpeg 加载失败: "+a.message,jt.value=!1,w.warning("MP4 转换功能暂时不可用，您仍可以下载 TS 格式文件"),!1}},fa=()=>{S.value=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<768},wa=()=>{fa()};return n((()=>{fa(),(()=>{try{const e=localStorage.getItem("m3u8-history");e&&($.value=JSON.parse(e))}catch(e){}})(),window.addEventListener("resize",wa)})),r((()=>{A.value&&(clearTimeout(A.value),A.value=null),U.value&&(U.value._hls&&(U.value._hls.destroy(),U.value._hls=null),U.value.src="",U.value.load()),window.removeEventListener("resize",wa)})),(e,l)=>(a(),d("div",F,[i("div",I,[l[47]||(l[47]=o('<div class="text-center mb-8" data-v-ec24910d><h1 class="text-4xl font-bold text-gray-800 mb-2" data-v-ec24910d>M3U8 在线播放器</h1><p class="text-gray-600" data-v-ec24910d>支持 M3U8 视频在线观看和下载转换</p><div class="text-sm text-gray-500 mt-2" data-v-ec24910d><span class="inline-flex items-center px-2 py-1 bg-blue-100 text-blue-800 rounded-full" data-v-ec24910d> 🤖 开发 </span></div></div>',1)),i("div",N,[i("div",j,[l[8]||(l[8]=i("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," M3U8 视频链接 ",-1)),i("div",z,[c(i("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>t.value=e),type:"text",placeholder:"请输入 M3U8 视频链接，按回车键即可播放...",class:g(["flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none text-sm md:text-base transition-all duration-200",{"border-blue-400 shadow-md":t.value.trim(),"border-gray-300":!t.value.trim()}]),onKeyup:m(aa,["enter"]),onInput:la},null,34),[[v,t.value]]),i("div",W,[i("button",{onClick:l[1]||(l[1]=e=>C.value=!C.value),class:g(["px-3 py-2 text-sm border rounded-lg transition-colors",$.value.length>0?"text-blue-700 border-blue-300 bg-blue-50 hover:bg-blue-100":"text-gray-400 border-gray-300 bg-gray-50 cursor-not-allowed"]),disabled:0===$.value.length,title:`历史记录 (${$.value.length})`}," 📝 ",10,q),i("button",{onClick:ha,class:"px-3 py-2 text-gray-500 hover:text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm"}," 清空 ")])]),t.value.trim()?(a(),d("div",G,l[7]||(l[7]=[o('<kbd class="px-1.5 py-0.5 bg-gray-100 border border-gray-300 rounded text-xs" data-v-ec24910d>Enter</kbd><span data-v-ec24910d>快速播放</span><span class="text-gray-400" data-v-ec24910d>|</span><span data-v-ec24910d>自动保存历史记录</span><span class="text-gray-400" data-v-ec24910d>|</span><span class="flex items-center gap-1" data-v-ec24910d><div class="w-2 h-2 bg-green-400 rounded-full animate-pulse" data-v-ec24910d></div><span data-v-ec24910d>智能代理已启用</span></span>',6)]))):u("",!0)]),i("div",B,[i("label",V,[c(i("input",{"onUpdate:modelValue":l[2]||(l[2]=e=>T.value=e),type:"checkbox",class:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"},null,512),[[p,T.value]]),l[9]||(l[9]=i("span",{class:"text-gray-700"},"自动播放",-1))]),i("button",{onClick:l[3]||(l[3]=e=>Gt.value=!Gt.value),class:"flex items-center gap-2 text-sm px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"},l[10]||(l[10]=[i("span",null,"⚙️",-1),i("span",null,"自定义 Header",-1)])),S.value?(a(),d("div",K," 📱 移动端模式 ")):u("",!0)]),Gt.value?(a(),d("div",J,[i("div",{class:"flex items-center justify-between mb-3"},[l[11]||(l[11]=i("h4",{class:"font-medium text-gray-700"},"HTTP Headers 配置",-1)),i("div",{class:"flex gap-2"},[i("button",{onClick:sa,class:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors"}," + 添加 "),i("button",{onClick:na,class:"text-xs px-2 py-1 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors"}," 重置 ")])]),i("div",Y,[(a(!0),d(h,null,x(qt.value,((e,t)=>(a(),d("div",{key:t,class:"flex items-center gap-2 text-sm"},[i("div",Z,y(t)+":",1),c(i("input",{"onUpdate:modelValue":e=>qt.value[t]=e,type:"text",placeholder:"Referer"===t||"Origin"===t?"自动设置":"请输入值",class:"flex-1 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent"},null,8,Q),[[v,qt.value[t]]]),i("button",{onClick:e=>(e=>{delete qt.value[e],w.success(`已删除 Header: ${e}`)})(t),class:"text-red-500 hover:text-red-700 text-xs",title:"删除此 Header"}," ✕ ",8,X)])))),128))]),l[12]||(l[12]=i("div",{class:"mt-3 text-xs text-gray-500"},[i("p",null,"💡 提示：Referer 和 Origin 会根据 M3U8 链接自动设置，也可手动覆盖")],-1))])):u("",!0),i("div",ee,[l[13]||(l[13]=i("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," 测试链接 ",-1)),i("div",te,[(a(),d(h,null,x(Bt,((e,a)=>i("button",{key:a,onClick:a=>(async e=>{t.value=e.url,Mt.value=`正在加载: ${e.name}`,await Zt()})(e),class:"px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors",title:e.url},y(e.name),9,ae))),64))])]),C.value?(a(),d("div",le,[i("div",se,[l[14]||(l[14]=i("h3",{class:"text-sm font-medium text-gray-700"},"播放历史",-1)),$.value.length>0?(a(),d("button",{key:0,onClick:ta,class:"text-xs text-red-600 hover:text-red-700"}," 清空历史 ")):u("",!0)]),i("div",ne,[(a(!0),d(h,null,x($.value,(e=>(a(),d("div",{key:e.id,class:"flex items-center justify-between p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"},[i("div",re,[i("div",de,y(e.title),1),i("div",ie,y(e.timestamp),1)]),i("div",oe,[i("button",{onClick:a=>(async e=>{t.value=e.url,C.value=!1,await Zt()})(e),class:"px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors"}," 播放 ",8,ue),i("button",{onClick:t=>{return a=e.id,$.value=$.value.filter((e=>e.id!==a)),void ea();var a},class:"px-2 py-1 text-xs bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors"}," 删除 ",8,ce)])])))),128))]),0===$.value.length?(a(),d("div",ve," 暂无播放历史 ")):u("",!0)])):u("",!0),i("div",me,[i("div",ge,[i("button",{onClick:Zt,disabled:O.value,class:g(["flex-1 sm:flex-none px-4 md:px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2 text-sm md:text-base",{"bg-green-600 hover:bg-green-700":t.value.trim()&&!O.value,"bg-blue-600 hover:bg-blue-700":!t.value.trim()&&!O.value}])},[O.value?(a(),d("span",he,"⟳")):t.value.trim()?(a(),d("span",xe,"▶️")):u("",!0),b(" "+y(O.value?"加载中...":t.value.trim()?"播放视频":"请先输入链接"),1)],10,pe),i("button",{onClick:va,class:"px-3 md:px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm md:text-base"},l[15]||(l[15]=[i("span",{class:"hidden sm:inline"},"下载 M3U8",-1),i("span",{class:"sm:hidden"},"M3U8",-1)]))]),i("div",be,[i("button",{onClick:ma,disabled:Ot.value||Dt.value,class:"flex-1 px-3 md:px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm md:text-base"},[Ot.value?(a(),d("span",fe,"⟳")):u("",!0),i("span",we,y(Ot.value?"下载中...":"下载 TS 文件"),1),i("span",Ee,y(Ot.value?"下载中":"TS"),1)],8,ye),jt.value&&!Dt.value?(a(),d("button",{key:0,onClick:ga,disabled:Ot.value,class:"flex-1 px-3 md:px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm md:text-base"},l[16]||(l[16]=[i("span",{class:"hidden sm:inline"},"转换为 MP4",-1),i("span",{class:"sm:hidden"},"MP4",-1)]),8,ke)):u("",!0),jt.value&&Dt.value?(a(),d("button",{key:1,onClick:oa,class:"flex-1 px-3 md:px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm md:text-base"},l[17]||(l[17]=[i("span",{class:"animate-spin mr-1"},"⟳",-1),i("span",{class:"hidden sm:inline"},"取消转换",-1),i("span",{class:"sm:hidden"},"取消",-1)]))):u("",!0),jt.value?u("",!0):(a(),d("div",_e,l[18]||(l[18]=[i("span",{class:"hidden sm:inline"},"MP4 转换不可用",-1),i("span",{class:"sm:hidden"},"MP4 不可用",-1)])))])]),Mt.value?(a(),d("div",Re,[i("div",{class:g(["text-sm mb-1",{"text-blue-600":Mt.value.includes("播放")||Mt.value.includes("准备"),"text-green-600":Mt.value.includes("成功"),"text-orange-600":Mt.value.includes("代理")||Mt.value.includes("尝试"),"text-red-600":Mt.value.includes("失败")}])},[l[19]||(l[19]=i("span",{class:"font-medium"},"播放状态:",-1)),b(" "+y(Mt.value)+" ",1),Mt.value.includes("代理")?(a(),d("span",Me," 智能代理模式 ")):u("",!0)],2)])):u("",!0),Ut.value?(a(),d("div",Le,[i("div",Ue,[l[20]||(l[20]=i("span",{class:"font-medium"},"TS 下载状态:",-1)),b(" "+y(Ut.value),1)]),Lt.value>0?(a(),d("div",Oe,[i("div",Te,[l[21]||(l[21]=i("span",null,"TS 下载进度",-1)),i("span",null,y(Lt.value)+"%",1)]),i("div",$e,[i("div",{class:"bg-purple-600 h-2 rounded-full transition-all duration-300",style:f({width:`${Lt.value}%`})},null,4)])])):u("",!0)])):u("",!0),At.value?(a(),d("div",Ce,[i("div",Se,[l[22]||(l[22]=i("span",{class:"font-medium"},"MP4 转换状态:",-1)),b(" "+y(At.value),1)]),St.value>0?(a(),d("div",Ae,[i("div",De,[l[23]||(l[23]=i("span",null,"MP4 转换进度",-1)),i("span",null,y(St.value)+"%",1)]),i("div",Pe,[i("div",{class:"bg-orange-600 h-2 rounded-full transition-all duration-500",style:f({width:`${St.value}%`})},null,4)])])):u("",!0),Ht.value.length>0?(a(),d("div",He,[l[24]||(l[24]=i("div",{class:"text-xs text-gray-600 mb-2"},"转换步骤:",-1)),i("div",Fe,[(a(!0),d(h,null,x(Ht.value,(e=>(a(),d("div",{key:e.id,class:g(["p-2 rounded text-xs text-center transition-colors duration-200",{"bg-gray-200 text-gray-500":"pending"===e.status,"bg-yellow-400 text-yellow-800 animate-pulse":"downloading"===e.status,"bg-green-500 text-white":"completed"===e.status,"bg-red-400 text-white":"error"===e.status}]),title:`${e.name}: ${e.status}`},y(e.name),11,Ie)))),128))])])):u("",!0),Pt.value.length>0?(a(),d("div",Ne,[i("div",je," 片段下载进度 ("+y(Pt.value.filter((e=>"completed"===e.status)).length)+"/"+y(Pt.value.length)+") ",1),i("div",{class:"grid gap-1",style:f({"grid-template-columns":`repeat(${Math.min(Pt.value.length,20)}, 1fr)`})},[(a(!0),d(h,null,x(Pt.value.slice(0,20),((e,t)=>(a(),d("div",{key:e.id,class:g(["h-3 rounded-sm transition-colors duration-200",{"bg-gray-200":"pending"===e.status,"bg-yellow-400 animate-pulse":"downloading"===e.status,"bg-green-500":"completed"===e.status,"bg-red-400":"error"===e.status}]),title:`片段 ${t+1}: ${e.status}`},null,10,ze)))),128))],4),i("div",{class:"grid gap-1 mt-1",style:f({"grid-template-columns":`repeat(${Math.min(Pt.value.length,20)}, 1fr)`})},[(a(!0),d(h,null,x(Pt.value,((e,t)=>(a(),d("div",{key:e.id,class:g(["h-3 rounded-sm transition-colors duration-200",{"bg-gray-200":"pending"===e.status,"bg-yellow-400 animate-pulse":"downloading"===e.status,"bg-green-500":"completed"===e.status,"bg-red-400":"error"===e.status}]),title:`片段 ${t+1}: ${e.status}`},y(t+1),11,We)))),128))],4)])):u("",!0),Dt.value?(a(),d("div",qe,l[25]||(l[25]=[i("div",{class:"flex items-center gap-2"},[i("div",{class:"animate-spin w-3 h-3 border border-orange-500 border-t-transparent rounded-full"}),i("span",null,"正在使用 FFmpeg 进行格式转换...")],-1)]))):u("",!0)])):u("",!0),Tt.value.length>0?(a(),d("div",Ge,[l[27]||(l[27]=i("div",{class:"text-sm text-purple-600 mb-2"},[i("span",{class:"font-medium"},"TS 片段下载状态:")],-1)),i("div",Be,[i("div",Ve,[i("span",null,"片段进度 ("+y(Ct.value)+"/"+y($t.value)+")",1),i("span",null,y(Math.round(Ct.value/$t.value*100))+"%",1)]),i("div",{class:"grid gap-1",style:f({"grid-template-columns":`repeat(${Math.min($t.value,20)}, 1fr)`})},[(a(!0),d(h,null,x(Tt.value.slice(0,20),((e,t)=>(a(),d("div",{key:e.id,class:g(["h-3 rounded-sm transition-colors duration-200",{"bg-gray-200":"pending"===e.status,"bg-yellow-400 animate-pulse":"downloading"===e.status,"bg-green-500":"completed"===e.status,"bg-red-400":"error"===e.status}]),title:`片段 ${t+1}: ${e.status}`},null,10,Ke)))),128))],4),$t.value>20?(a(),d("div",Je," 显示前 20 个片段，共 "+y($t.value)+" 个 ",1)):u("",!0),l[26]||(l[26]=o('<div class="flex gap-4 text-xs text-gray-500 mt-2" data-v-ec24910d><div class="flex items-center gap-1" data-v-ec24910d><div class="w-2 h-2 bg-gray-200 rounded-sm" data-v-ec24910d></div><span data-v-ec24910d>等待</span></div><div class="flex items-center gap-1" data-v-ec24910d><div class="w-2 h-2 bg-yellow-400 rounded-sm" data-v-ec24910d></div><span data-v-ec24910d>下载中</span></div><div class="flex items-center gap-1" data-v-ec24910d><div class="w-2 h-2 bg-green-500 rounded-sm" data-v-ec24910d></div><span data-v-ec24910d>完成</span></div><div class="flex items-center gap-1" data-v-ec24910d><div class="w-2 h-2 bg-red-400 rounded-sm" data-v-ec24910d></div><span data-v-ec24910d>失败</span></div></div>',1))])])):u("",!0)]),i("div",Ye,[i("div",Ze,[l[30]||(l[30]=i("h2",{class:"text-lg md:text-xl font-semibold text-gray-800"},"视频播放器",-1)),i("div",Qe,[U.value?(a(),d("button",{key:0,onClick:xa,class:"px-2 md:px-3 py-1 text-xs md:text-sm bg-gray-100 hover:bg-gray-200 rounded transition-colors"},l[28]||(l[28]=[i("span",{class:"hidden sm:inline"},"全屏",-1),i("span",{class:"sm:hidden"},"⛶",-1)]))):u("",!0),U.value?(a(),d("button",{key:1,onClick:ba,class:"px-2 md:px-3 py-1 text-xs md:text-sm bg-blue-100 hover:bg-blue-200 text-blue-700 rounded transition-colors"},l[29]||(l[29]=[i("span",{class:"hidden sm:inline"},"刷新",-1),i("span",{class:"sm:hidden"},"⟳",-1)]))):u("",!0)])]),i("div",Xe,[i("video",{ref_key:"videoElement",ref:U,id:"video-player",class:"w-full bg-black rounded-lg overflow-hidden",style:f({"min-height":S.value?"250px":"400px","aspect-ratio":"16/9"}),controls:"",playsinline:"",preload:"metadata"},null,4),O.value?(a(),d("div",et,l[31]||(l[31]=[i("div",{class:"text-white text-center"},[i("div",{class:"animate-spin w-6 md:w-8 h-6 md:h-8 border-2 border-white border-t-transparent rounded-full mx-auto mb-2"}),i("div",{class:"text-sm md:text-base"},"正在加载视频...")],-1)]))):u("",!0),U.value||O.value?u("",!0):(a(),d("div",tt,l[32]||(l[32]=[i("div",{class:"text-center text-gray-500"},[i("div",{class:"text-3xl md:text-4xl mb-2"},"🎥"),i("div",{class:"text-sm md:text-base px-4"},"请输入 M3U8 链接开始播放")],-1)])))]),i("div",at,[i("div",lt,[l[33]||(l[33]=i("span",{class:"w-2 h-2 bg-green-400 rounded-full"},null,-1)),l[34]||(l[34]=i("span",null,"支持 HLS (M3U8) 视频流播放",-1)),T.value?(a(),d("span",st,"• 自动播放已启用")):u("",!0)])])]),i("div",nt,[l[45]||(l[45]=o('<h3 class="text-lg font-semibold text-gray-800 mb-4" data-v-ec24910d>功能特色</h3><div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6" data-v-ec24910d><div data-v-ec24910d><h4 class="font-medium text-gray-700 mb-2" data-v-ec24910d>🎥 智能播放</h4><p class="text-sm text-gray-600" data-v-ec24910d> 支持 M3U8 格式视频在线播放，自动播放选项，移动端优化适配。 </p></div><div data-v-ec24910d><h4 class="font-medium text-gray-700 mb-2" data-v-ec24910d>📝 播放历史</h4><p class="text-sm text-gray-600" data-v-ec24910d> 自动记录播放历史，支持快速重播，本地存储永不丢失。 </p></div><div data-v-ec24910d><h4 class="font-medium text-gray-700 mb-2" data-v-ec24910d>📱 移动适配</h4><p class="text-sm text-gray-600" data-v-ec24910d> 完美适配手机和平板设备，响应式设计，触控优化。 </p></div><div data-v-ec24910d><h4 class="font-medium text-gray-700 mb-2" data-v-ec24910d>📥 多格式下载</h4><p class="text-sm text-gray-600" data-v-ec24910d> 支持 M3U8 原始文件下载、TS 文件下载和 MP4 格式转换。 </p></div><div data-v-ec24910d><h4 class="font-medium text-gray-700 mb-2" data-v-ec24910d>⚡ 快速加载</h4><p class="text-sm text-gray-600" data-v-ec24910d> 基于 hls.js 播放器，加载速度快，播放流畅稳定。 </p></div><div data-v-ec24910d><h4 class="font-medium text-gray-700 mb-2" data-v-ec24910d>🎨 简约设计</h4><p class="text-sm text-gray-600" data-v-ec24910d> 界面简洁优雅，操作直观，专注于用户体验。 </p></div></div>',2)),i("div",rt,[l[43]||(l[43]=i("h4",{class:"font-medium text-green-800 mb-2"},"🛡️ 智能代理系统",-1)),i("div",dt,[l[42]||(l[42]=i("p",null,"本系统集成了多重 CORS 代理，自动绕过 403 防盗链限制。",-1)),i("div",it,[l[38]||(l[38]=i("p",{class:"font-medium mb-1"},"代理策略：",-1)),i("ul",ot,[H.value?u("",!0):(a(),d("li",ut,"• 优先直接访问（最快速度）")),H.value?(a(),d("li",ct,"• 优先使用代理（绕过限制）")):u("",!0),l[35]||(l[35]=i("li",null,"• 失败时自动回退到另一种方式",-1)),l[36]||(l[36]=i("li",null,"• 智能记忆成功的代理配置",-1)),l[37]||(l[37]=i("li",null,"• 支持多种代理服务确保高成功率",-1))])]),i("div",vt,[i("div",mt,[i("div",gt,[c(i("input",{id:"proxy-toggle",type:"checkbox","onUpdate:modelValue":l[4]||(l[4]=e=>H.value=e),class:"w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500 focus:ring-2"},null,512),[[p,H.value]]),l[39]||(l[39]=i("label",{for:"proxy-toggle",class:"text-sm font-medium text-gray-700 cursor-pointer"}," 默认使用代理 ",-1))]),i("div",pt,y(H.value?"优先使用代理播放":"优先直接播放"),1)]),i("div",ht,[i("div",null,[l[40]||(l[40]=i("span",null,"当前状态：",-1)),i("span",xt,y(D.value),1)]),i("div",bt,[i("button",{onClick:l[5]||(l[5]=e=>P.value=!P.value),class:"text-xs px-2 py-1 bg-green-200 text-green-700 rounded hover:bg-green-300 transition-colors"},y(P.value?"隐藏代理":"切换代理"),1),i("button",{onClick:ra,class:"text-xs px-2 py-1 bg-blue-200 text-blue-700 rounded hover:bg-blue-300 transition-colors"}," 测试代理 ")])]),P.value?(a(),d("div",yt,[l[41]||(l[41]=i("div",{class:"text-xs text-gray-600 mb-2"},"选择代理服务：",-1)),i("div",ft,[(a(),d(h,null,x(zt,((e,t)=>i("div",{key:t,class:"flex items-center justify-between p-1 rounded hover:bg-gray-50"},[i("div",wt,[c(i("input",{id:`proxy-${t}`,type:"radio",value:t,"onUpdate:modelValue":l[6]||(l[6]=e=>Wt.value=e),onChange:e=>(e=>{Wt.value=e,D.value=`代理 ${e+1}`,P.value=!1,w.success(`已切换到代理 ${e+1}`)})(t),class:"w-3 h-3"},null,40,Et),[[L,Wt.value]]),i("label",{for:`proxy-${t}`,class:"text-xs cursor-pointer"}," 代理 "+y(t+1)+": "+y(e),9,kt)]),t===Wt.value?(a(),d("span",_t," 当前 ")):u("",!0)]))),64))])])):u("",!0)])])]),Mt.value.includes("403")||Ut.value.includes("403")?(a(),d("div",Rt,l[44]||(l[44]=[o('<h4 class="font-medium text-yellow-800 mb-2" data-v-ec24910d>⚠️ 防盗链保护检测</h4><div class="text-sm text-yellow-700 space-y-2" data-v-ec24910d><p data-v-ec24910d>检测到防盗链保护，系统正在自动尝试代理访问。</p><div class="bg-yellow-100 p-3 rounded border-l-4 border-yellow-400" data-v-ec24910d><p class="font-medium mb-1" data-v-ec24910d>如果仍然无法访问：</p><ul class="space-y-1" data-v-ec24910d><li data-v-ec24910d>• 该资源可能需要特殊的访问权限</li><li data-v-ec24910d>• 尝试刷新页面重新获取</li><li data-v-ec24910d>• 联系资源提供方确认访问方式</li></ul></div></div>',2)]))):u("",!0),l[46]||(l[46]=o('<div class="mt-6 p-4 bg-blue-50 rounded-lg" data-v-ec24910d><h4 class="font-medium text-blue-800 mb-2" data-v-ec24910d>💡 使用提示</h4><ul class="text-sm text-blue-700 space-y-1" data-v-ec24910d><li data-v-ec24910d>• 开启自动播放可以更快开始观看视频</li><li data-v-ec24910d>• 播放历史会自动保存，方便下次继续观看</li><li data-v-ec24910d>• 移动端支持全屏播放和手势控制</li><li data-v-ec24910d>• 🆕 自定义 Header 功能：完全控制 HTTP 请求头，绕过防盗链</li><li data-v-ec24910d>• 智能播放系统：先尝试直接播放，失败时自动切换代理</li><li data-v-ec24910d>• Referer 和 Origin 会根据链接自动设置，也可手动覆盖</li><li data-v-ec24910d>• TS 文件下载保持原始格式，MP4 转换使用 FFmpeg 确保质量</li><li data-v-ec24910d>• 分块下载显示让进度更清晰可见</li></ul></div>',1))])])]))}},[["__scopeId","data-v-ec24910d"]]),Lt=U({history:O("/m3u8palyer/"),routes:[{path:"/",name:"home",component:Mt},{path:"/about",name:"about",component:()=>function(e,t){let a=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),l=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));a=Promise.allSettled(t.map((e=>{if((e=function(e){return"/m3u8palyer/"+e}(e))in H)return;H[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script"),s.crossOrigin="",s.href=e,l&&s.setAttribute("nonce",l),document.head.appendChild(s),t?new Promise(((t,a)=>{s.addEventListener("load",t),s.addEventListener("error",(()=>a(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function l(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then((t=>{for(const e of t||[])"rejected"===e.status&&l(e.reason);return e().catch(l)}))}((()=>import("./views/About-B0QLw5jp.js")),__vite__mapDeps([0,1,2,3]))}]}),Ut=T(S);Ut.use(P),Ut.use($()),Ut.use(Lt),Ut.mount("#app");export{C as _};
